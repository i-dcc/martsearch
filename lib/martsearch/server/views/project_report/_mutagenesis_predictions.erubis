<div class="dataset">
  <h4 class="dataset_title toggle-open">Mutagenesis Predictions</h4>
  <div class="dataset_content">

    <p>
      This tool shows the predicted structure of the gene transcripts after successful
      mutation. The image below shows what a typical transcript may look like (this is
      an example only).  Click the 'view' button for each transcript to see the full
      prediction for that transcript.
    </p>

    <table class="noborder">
      <tbody class="">
        <tr>

          <!-- Display the mutagenesis predictions -->
          <td style="vertical-align:top" width="80%">
            <table class="border" width="100%">
              <thead>
                <th>Ensembl transcript id</th>
                <th>Biotype</th>
                <th>Floxed transcript description</th>
                <th>Details</th>
                <th>Protein sequence</th>
              </thead>
              <tbody>

                <!-- Process the transcripts -->
                <% @data[:mutagenesis_predictions].each do |transcript| %>
                  <% if transcript.class == Hash or transcript.class == BSON::OrderedHash %>
                    <tr class="transcript">
                     <td>
                      <a href="<%= ensembl_link_url_from_transcript( @data[:ensembl_gene_id], transcript[:ensembl_transcript_id] ) %>">
                        <%= transcript[:ensembl_transcript_id] %>
                      </a>
                     </td>
                     <td><%= transcript[:biotype] %></td>
                     <td><%= transcript[:floxed_transcript_description] %></td>
                     <td>
                       <% unless transcript[:exons].nil? or transcript[:exons].empty? %>
                         <a class="details_toggle toggle-close">view</a>
                       <% end %>
                     </td>
                     <td><%= transcript[:floxed_transcript_translation] %></td>
                    </tr>

                    <!-- Process the exon details -->
                    <% unless transcript[:exons].nil? or transcript[:exons].empty? %>
                      <tr class="details">
                        <td colspan="4">
                          <%= partial("project_report/transcript", :locals => { :transcript => transcript, :transcript_id => transcript[:ensembl_transcript_id] } ) %>
                        </td>
                      </tr>
                    <% end %>
                  <% end %>
                <% end %>
              </tbody>
            </table>
          </td>

          <!-- Display the key -->
          <td style="vertical-align:top">
            <table>
              <tbody>
                <!-- Insert the key explaining the predictions (may have to be a partial) -->
                <tr>
                  <div class="">
                    <%= image_tag '/images/mutagenesis_prediction_key.png', { :width => 300 } %>
                  </div>
                </tr>

                <tr>
                  <table>
                    <tr>
                      <td class="noborder"><strong>Legend:</strong></td>
                      <td class="noborder"><strong>C</strong></td>
                      <td class="noborder">CDS</td>
                      <td class="noborder"><strong>D</strong></td>
                      <td class="noborder">deleted exon</td>
                      <td class="noborder"><strong>U</strong></td>
                      <td class="noborder">UTR</td>
                    </tr>
                    <tr>
                      <td class="noborder"></td>
                      <td class="exon_upstream"/>
                      <td class="noborder">in frame</td>
                      <td class="exon_deleted"/>
                      <td class="noborder">deleted</td>
                      <td class="exon_frameshifted"/>
                      <td class="noborder">frameshifted</td>
                    </tr>
                  </table>
                </tr>
              </tbody>
            </table>
          </td>

        </tr>
      </tbody>
    </table>

    
    <div class="clear"></div>
  </div>
</div>
